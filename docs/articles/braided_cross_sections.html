<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content='"Adding braided Cross Sections to Hydrofabric Datasets"
'>
<title>NOAA OWP Braided Cross Section Reparation • hydrofabric3D</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="NOAA OWP Braided Cross Section Reparation">
<meta property="og:description" content='"Adding braided Cross Sections to Hydrofabric Datasets"
'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydrofabric3D</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>NOAA OWP Braided Cross Section Reparation</h1>
                        <h4 data-toc-skip class="author">Angus
Watters</h4>
            <address class="author_afil">
      Lynker, NOAA-Affiliate<br><div class="d-none name"><code>braided_cross_sections.Rmd</code></div>
    </address>
</div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette breaks down the methods used within
<code>hydrofabric3D</code> to cut cross sections across complex braided
river networks. The following methods extend from the cross section
cutting algorithms explained <a href="../articles/cross_section_generator.html">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hydrofabric3D</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doi-usgs.github.io/nhdplusTools/" class="external-link">nhdplusTools</a></span><span class="op">)</span></span></code></pre></div>
<p>We begin with a testing set of braided flowlines located in Baton
Rouge, LA. This area has a complex set of braids and highlights the need
for rectifying cross section linestrings to better reflect the natural
world.</p>
<p>Starting from the COMID 18717056, we traverse upstream 30km and get a
set of 303 flowlines.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Heavily braided network in Baton Rouge, LA</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/navigate_network.html" class="external-link">navigate_network</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">18717056</span>, mode <span class="op">=</span> <span class="st">"UT"</span>,  distance_km <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flood_plain_sections</span> <span class="op">=</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">net</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2013WR013916</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    bf_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">0.700</span>     <span class="op">+</span> <span class="fl">0.365</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">totdasqkm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    cs_width <span class="op">=</span> <span class="va">flood_plain_sections</span> <span class="op">*</span> <span class="va">bf_width</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">comid</span>, <span class="va">divergence</span>,<span class="va">bf_width</span>, <span class="va">cs_width</span>, <span class="va">lengthkm</span>, <span class="va">totdasqkm</span>, <span class="va">fromnode</span>, <span class="va">tonode</span>, <span class="va">terminalpa</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set geometry name of network to "geometry"</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu">nhdplusTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/hydroloom/man/rename_geometry.html" class="external-link">rename_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"geometry"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/network_plot.png" width="100%"></p>
<p><br></p>
<p>Now let’s add cross sections using the algorithm described <a href="cross_section_generator.Rmd">here</a></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transects</span> <span class="op">&lt;-</span> <span class="fu">hydrofabric3D</span><span class="fu">::</span><span class="fu"><a href="../reference/cut_cross_sections.html">cut_cross_sections</a></span><span class="op">(</span></span>
<span>  net        <span class="op">=</span> <span class="va">net</span>,</span>
<span>  id         <span class="op">=</span> <span class="st">"comid"</span>,</span>
<span>  cs_widths  <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  num        <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  fix_braids <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  add        <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span></code></pre></div>
<p><img src="../reference/figures/all_transects_plot.png" width="100%"></p>
<p><br></p>
<p>Here we have created our cross sections lines with 10 transect lines
per COMID/flowline geometry. The problem here is that this section of
river is braided and we want to have cross sections extend across
multiple flowlines in some cases such that the cross section line
represents that width across the braided river sections, instead of
having individual transect lines for each of the parallel braided
flowlines.</p>
<p>This presents a problem as braided systems are inherently complex and
irregular. If we want to try and extend cross section lines across all
flowlines in a given braid, the first thing we need is a way of uniquely
identifying each braid and all of the flowlines within that braid.</p>
<p>To accomplish this, we made use of the flowline
<code>from/tonode</code> topology relationships, and implemented a Depth
First Search (DFS) graph traversal algorithm on the flowline network.
The DFS algorithm was implemented in such a way as to identify and
return the set of COMIDs that make each individual closed loop braid in
the network.</p>
</div>
<div class="section level2">
<h2 id="locate-braided-flowlines">Locate braided flowlines<a class="anchor" aria-label="anchor" href="#locate-braided-flowlines"></a>
</h2>
<p>The <code><a href="../reference/find_braids.html">find_braids()</a></code> function can be used to identify and
assign a <code>braid_id</code> to each flowline in a NHDPlus network
dataset. The input network data must include a <code>comid</code>,
<code>fromnode</code>, <code>tonode</code>, and <code>divergence</code>
attributes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add braid_id column to network</span></span>
<span><span class="va">braids</span> <span class="op">&lt;-</span> <span class="fu">hydrofabric3D</span><span class="fu">::</span><span class="fu"><a href="../reference/find_braids.html">find_braids</a></span><span class="op">(</span></span>
<span>    network     <span class="op">=</span> <span class="va">net</span>, </span>
<span>    add         <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    nested      <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in nhdplusTools::make_node_topology(network, div, add = TRUE):</span></span>
<span><span class="co">#&gt; nhdplusTools make_node_topology is deprecated. Use hydroloom version.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in nhdplusTools::make_node_topology(network, div, add = TRUE):</span></span>
<span><span class="co">#&gt; nhdplusTools make_node_topology is deprecated. Use hydroloom version.</span></span></code></pre></div>
<center>
<div class="float">
<img src="../reference/figures/braid_vignette_gif.gif" alt="Animation showing braid IDs"><div class="figcaption">Animation showing braid IDs</div>
</div>
</center>
<p><br></p>
<p>Now we have a method for identifying <em>which</em> flowlines are
part of a braid and unique ID for each of the braids in the network.
Next, we will find the cross section lines that are on these braided
flowlines, and work on extending them to encompass the entire width of
the river by crossing across the rest of the braided flowlines.</p>
<p>First we want to join our transect lines with the sections of rivers
with all flowlines that have a <code>braid_id</code> (flowlines that are
NOT part of a braid have a <code>braid_id</code> of “no_braid”)</p>
<p>So we seperate the braided flowlines from the non braided
flowlines:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># not braided flowlines</span></span>
<span><span class="va">not_braids</span> <span class="op">&lt;-</span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">braids</span>, <span class="va">braid_id</span> <span class="op">==</span> <span class="st">"no_braid"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># trim down network to just the braided parts, and add a comid count to separate out multibraids</span></span>
<span><span class="va">braids</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">braids</span>, <span class="va">braid_id</span> <span class="op">!=</span> <span class="st">"no_braid"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># add connected component "component_id" column</span></span>
<span><span class="va">braids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_connected_components.html">find_connected_components</a></span><span class="op">(</span><span class="va">braids</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in nhdplusTools::make_node_topology(network, div, add = TRUE):</span></span>
<span><span class="co">#&gt; nhdplusTools make_node_topology is deprecated. Use hydroloom version.</span></span></code></pre></div>
<p><br></p>
<p>Then join the braided flowlines with the transects</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cross_sections</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">transects</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">hy_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">braids</span><span class="op">$</span><span class="va">comid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>      <span class="va">braids</span>, <span class="va">comid</span>, <span class="va">braid_id</span>, <span class="va">is_multibraid</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hy_id"</span> <span class="op">=</span> <span class="st">"comid"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">totdasqkm</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>That gives us this set of all cross sections on braided
flowlines:</p>
<p><img src="../reference/figures/braid_xs_plot.png" width="100%"></p>
<p>We can now iterate over all of these cross sections and determine
which cross sections should be extended, in what order, and by what
distance.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="identify-flowlines-to-extend-across">Identify flowlines to extend across<a class="anchor" aria-label="anchor" href="#identify-flowlines-to-extend-across"></a>
</h2>
<p>For each braided COMID, we want to take each of the cross sections
lines on that COMID and try to extend these cross sections to cut across
all of the other relevant braided flowlines in the area. The image below
highlights for the “origin” COMID (blue), which other flowlines (red)
are selected for the transect algorithm to try and cut across to
generate an extended cross section geometry.</p>
<p>The red flowlines are the set of all neighboring braided flowlines of
the “origin” COMID (blue). transect extension algorithm takes transect
linestrings on the blue COMID and tries to extend these cross sections
to cut across all of the neighboring flowlines (red)</p>
<p><img src="../reference/figures/geoms_to_cut_plot.png" width="100%"></p>
<p>To see this for all braided flowlines in the network, the animation
below walks through each COMID of the braided flowlines (blue), and
shows which of the remaining other braided flowlines are eligible to be
cut across from the any of the cross sections lines on the “origin”
COMID (blue).</p>
<p><img src="../reference/figures/geoms_to_cut_gif.gif" width="100%"></p>
<p>If we look at an individual COMID in a given braid, and we decide we
want to extend our cross sections for that COMID outward to try and cut
across other flowlines within the same braided system, we now have a
method for selecting which <strong>other</strong> COMIDs are candidates
for the extended line to cut across.</p>
<p>If we didn’t come up with a way of distinguishing which flowlines our
extended transect lines were allowed to cross over, then our algorithm
would ultimately try and extend each transect out indefinitely/attempt
to cut across ALL other flowlines in the network. This wouldn’t make
hydrologic or computational sense.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="order-of-extensions">Order of extensions<a class="anchor" aria-label="anchor" href="#order-of-extensions"></a>
</h2>
<p>When ever we take a transect line and extend it outward in either
direction, we run into the possibility that our newly extended transect
line will now violate one of the fundemental properties of our cross
sections:</p>
<ol style="list-style-type: decimal">
<li>The extended transect line now intersects with <em>another flowline
outside of the braided area</em>
</li>
<li>The extended transect line now intersects with <em>another transect
line</em>
</li>
<li>The extended transect line now intersects with <em>its own
COMID/flowline</em>
</li>
</ol>
<p>Moreover, some flowlines in a braided system should be given priority
over other flowlines when it comes to the order that their transects are
extended. Transect lines in the <strong>middle</strong> of a braided
system should be extended first as they are likely to produce the most
representative transect line, so we want to prioritize extending these
first.</p>
<p>Determining the middle flowline in a braided system was a challenge.
In some cases, the mainstem flowline is the middle flowline within a
braid, but in some cases this isn’t the case. We found a solution that
relies on the number of intersections a flowlines transect line has when
it is extended in either direction. From each transect line, we can
count the number of intersections on either side of the transect when we
extend the transect line out as far as needed to cross all neighboring
flowlines.</p>
<p>Using this technique we classified each cross section line into 5
different catagories according to its relative position within the
braided system:</p>
<ol style="list-style-type: decimal">
<li><p><strong>No intersection:</strong> transect line never intersects
another flowline after maximum extension in both directions</p></li>
<li><p><strong>Outer single:</strong> Transect line will intersect zero
flowlines in one direction, and exactly one other flowline in the other
direction, this is the case when a braid has just 2 parts.</p></li>
<li><p><strong>Outer multiple:</strong> Transect line will intersect
zero flowlines in one direction, and more than one other flowline in the
other direction</p></li>
<li><p><strong>Inner:</strong> Transect line is in the middle of a
braid. There are 2 scenarios, either there is an <em>even</em> or an
<em>odd</em> number of parallel flowlines in the braid:</p></li>
</ol>
<ul>
<li>
<strong>Odd case:</strong> Same number of intersections in both
directions</li>
</ul>
<p><span class="math display">\[
intersects\_count_1 == intersects\_count_2
\]</span></p>
<ul>
<li>
<strong>Even case:</strong> the maximum number of counted
intersections minus one equals the minimum number of counted
intersections</li>
</ul>
<p><span class="math display">\[
\max(intersects\_count_1, intersects\_count_2) - 1 ==
\min(intersects\_count_1, intersects\_count_2)
\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>
<strong>In between</strong> - Transect line is between the middle
and the outer portion of the braid</li>
</ol>
<p><br></p>
<p>These relationships are shown using a simple set of parallel lines
meant to represent flowlines in a braid. The red line in the image set
below highlights the specific line(s) that fall into the given
classification.</p>
<div id="positions_within_braids_accordion" class="panel-group" role="tablist" aria-multiselectable="true">
<div class="panel panel-default" id="positions_within_braids_accordion-0">
<div id="positions_within_braids_accordion-0-heading" class="panel-heading" role="tab">
<h4 class="panel-title">
<a data-toggle="collapse" role="button" href="#positions_within_braids_accordion-0-collapse" data-parent="#positions_within_braids_accordion" aria-expanded="true" aria-controls="positions_within_braids_accordion-0-collapse">Inner (odd case)</a>
</h4>
</div>
<div aria-labelledby="positions_within_braids_accordion-0-heading" class="panel-collapse collapse in" id="positions_within_braids_accordion-0-collapse" role="tabpanel">
<div class="panel-body" style="">
<img src="../reference/figures/odd_middle.png" class="img-responsive center-block">
</div>
</div>
</div>
<div class="panel panel-default" id="positions_within_braids_accordion-1">
<div id="positions_within_braids_accordion-1-heading" class="panel-heading" role="tab">
<h4 class="panel-title">
<a data-toggle="collapse" role="button" href="#positions_within_braids_accordion-1-collapse" data-parent="#positions_within_braids_accordion" aria-expanded="true" aria-controls="positions_within_braids_accordion-1-collapse">Inner (even case)</a>
</h4>
</div>
<div id="positions_within_braids_accordion-1-collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="positions_within_braids_accordion-1-heading">
<div class="panel-body" style="">
<img src="../reference/figures/even_middle.png" class="img-responsive center-block">
</div>
</div>
</div>
<div class="panel panel-default" id="positions_within_braids_accordion-2">
<div id="positions_within_braids_accordion-2-heading" class="panel-heading" role="tab">
<h4 class="panel-title">
<a data-toggle="collapse" role="button" href="#positions_within_braids_accordion-2-collapse" data-parent="#positions_within_braids_accordion" aria-expanded="true" aria-controls="positions_within_braids_accordion-2-collapse">In between</a>
</h4>
</div>
<div id="positions_within_braids_accordion-2-collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="positions_within_braids_accordion-2-heading">
<div class="panel-body" style="">
<img src="../reference/figures/in_between.png" class="img-responsive center-block">
</div>
</div>
</div>
<div class="panel panel-default" id="positions_within_braids_accordion-3">
<div id="positions_within_braids_accordion-3-heading" class="panel-heading" role="tab">
<h4 class="panel-title">
<a data-toggle="collapse" role="button" href="#positions_within_braids_accordion-3-collapse" data-parent="#positions_within_braids_accordion" aria-expanded="true" aria-controls="positions_within_braids_accordion-3-collapse">Outer single</a>
</h4>
</div>
<div id="positions_within_braids_accordion-3-collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="positions_within_braids_accordion-3-heading">
<div class="panel-body" style="">
<img src="../reference/figures/outer_single.png" class="img-responsive center-block">
</div>
</div>
</div>
<div class="panel panel-default" id="positions_within_braids_accordion-4">
<div id="positions_within_braids_accordion-4-heading" class="panel-heading" role="tab">
<h4 class="panel-title">
<a data-toggle="collapse" role="button" href="#positions_within_braids_accordion-4-collapse" data-parent="#positions_within_braids_accordion" aria-expanded="true" aria-controls="positions_within_braids_accordion-4-collapse">Outer multiple</a>
</h4>
</div>
<div id="positions_within_braids_accordion-4-collapse" class="panel-collapse collapse" role="tabpanel" aria-labelledby="positions_within_braids_accordion-4-heading">
<div class="panel-body" style="">
<img src="../reference/figures/outer_multi.png" class="img-responsive center-block">
</div>
</div>
</div>
</div>
<p><br></p>
<p>In order to get the best set of final transect lines, we prioritize
the “inner” transect lines and work on extending these ones first.</p>
<p>This plot highlights how cross sections are separated into groups
such that some cross sections (red) are in line to be extended first,
and the other group (blue) being extended after the first set of cross
sections is extended and processed</p>
<p><img src="../reference/figures/pre_extension_order_plot.png" width="100%"></p>
<p><br></p>
<p>A check is done on these new extended transect lines to make sure
they are not intersecting other parts of the original network, or any
other cross section linestrings.</p>
<p>We identify cross sections linestrings that intersect with any of the
original, non braided network flowlines, and we remove these cross
sections from our data.</p>
<p>After our first pass through of the cross section extension
algorithm, we want to make sure that any “inner” cross sections that
were NOT CHANGED, do not intersect with any of our other cross section
lines we just updated. We then remove any inner cross sections that
<em>do</em> intersect with ANY of the other cross sections, and keeping
the rest of the unextended inner cross sections in our data.</p>
<p>We then separate the cross section data based on whether the cross
section has already been changed/updated during the first pass through
of the line extension algorithm, or not. This gives us 2 separate set of
cross sections:</p>
<ol style="list-style-type: decimal">
<li><p>A set of inner cross section lines that have been (extended AND
checked for any violating intersections) OR were NOT extended and DO NOT
violate any intersections.</p></li>
<li><p>The rest of the unchanged cross sections that need to be
processed/extended (without intersecting any of the transect lines in
the first dataset of processed “inner” cross sections)</p></li>
</ol>
<p><br></p>
</div>
<div class="section level2">
<h2 id="process-inner-cross-sections">Process inner cross sections<a class="anchor" aria-label="anchor" href="#process-inner-cross-sections"></a>
</h2>
<p>We run the transect extension algorithm on the first group of cross
sections and we end up with this set of extended cross sections:</p>
<center>
<div class="float">
<img src="../reference/figures/final_inner_cross_sections.png" alt="Final set of inner cross sections"><div class="figcaption">Final set of inner cross sections</div>
</div>
</center>
<p><br></p>
</div>
<div class="section level2">
<h2 id="process-other-cross-sections">Process other cross sections<a class="anchor" aria-label="anchor" href="#process-other-cross-sections"></a>
</h2>
<p>We then take the remaining “other” cross sections (cross sections
that are on braided flowlines that are NOT part of the first set of
extended cross cross sections) and begin extending any of the other
remaining eligible cross sections.</p>
<center>
<div class="float">
<img src="../reference/figures/extension_order_plot.png" alt="Red cross sections indicate cross sections that were processed/extended first, while blue cross sections were processed after the set of red cross sections have been processed"><div class="figcaption">Red cross sections indicate cross sections that
were processed/extended first, while blue cross sections were processed
after the set of red cross sections have been processed</div>
</div>
</center>
<p><br></p>
</div>
<div class="section level2">
<h2 id="bring-it-all-back-together">Bring it all back together<a class="anchor" aria-label="anchor" href="#bring-it-all-back-together"></a>
</h2>
<p>Now that we have gone through and fixed cross section on braided
flowlines, we can merge our updated/extended cross section linestrings
<em>back</em> with the rest of our original set of cross section
lines</p>
<p><img src="../reference/figures/comparing_transects_plot.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mike Johnson, Angus Watters.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
